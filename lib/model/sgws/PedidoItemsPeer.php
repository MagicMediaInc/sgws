<?php


/**
 * Skeleton subclass for performing query and update operations on the 'pedido_items' table.
 *
 * 
 *
 * This class was autogenerated by Propel 1.4.1 on:
 *
 * 07/01/2014 15:48:59
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    lib.model.sgws
 */
class PedidoItemsPeer extends BasePedidoItemsPeer {
    
    public static function deleteItems($id)
    {
        $c = new Criteria();
        $c->add(self::ID_PEDIDO, $id, Criteria::EQUAL);
        return self::doDelete($c);
    }
    
    public static function actualizaItem($id, $qty)
    {
        $rs = self::retrieveByPK($id);
        $rs->setQt($qty);
        $rs->setPrecoBoleto($rs->getPreco() * $qty);
        $rs->save();
        return true;
    }

    public static function getOrderDetails($pedido)
    {
        $c = new Criteria();
        //Eliminamos la columnas de seleccion en caso de que esten definidas
        $c->clearSelectColumns();
        //Se Agregan las Columnas necesarias
        $c->addSelectColumn(self::ID);
        $c->addSelectColumn(self::ID_PEDIDO);
        $c->addSelectColumn(self::ID_PRODUCTO);
        $c->addSelectColumn(ProductosPeer::FOTO);
        $c->addSelectColumn(ProductosPeer::COR);
        $c->addSelectColumn(self::NUMERO_PEDIDO);
        $c->addSelectColumn(self::NOME);
        $c->addSelectColumn(self::QT);
        $c->addSelectColumn(self::PRECO);
        $c->addSelectColumn(self::PESO);
        $c->addSelectColumn(self::PRECO_BOLETO);
        $c->addSelectColumn(self::DESCONTO);
        $c->addSelectColumn(self::DESCONTO_BOLETO);
        
        $c->add(self::ID_PEDIDO, $pedido, Criteria::EQUAL);
        $c->addJoin(self::ID_PRODUCTO, ProductosPeer::ID, Criteria::INNER_JOIN);
        //Ejecucion de consulta
        $rs = self::doSelectStmt($c);
        //Se recuperan los registros y se genera arreglo
        while($res = $rs->fetch())
        {
            $dato['id']          = $res['ID'];
            $dato['id_pedido']          = $res['ID_PEDIDO'];
            $dato['id_producto']        = $res['ID_PRODUCTO'];
            $dato['foto']        = $res['FOTO'];
            $dato['color']        = $res['COR'];
            $dato['numero_pedido']      = $res['NUMERO_PEDIDO'];
            $dato['nome']              = $res['NOME'];
            $dato['qty']              = $res['QT'];
            $dato['price']             = $res['PRECO'];
            $dato['peso']              = $res['PESO'];
            $dato['price_boleto']       = $res['PRECO_BOLETO'];
            $dato['desconto']          = $res['DESCONTO'];
            $dato['desconto_boleto']    = $res['DESCONTO_BOLETO'];
            $datos[] = $dato;
        }
        if(!empty($datos))
        {
            return $datos;
        }else{
            return false;
        }
    }

} // PedidoItemsPeer
